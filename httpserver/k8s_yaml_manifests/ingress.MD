### install ingress controller
```
kubectl create -f ingress-nginx-deployment.yaml
```

### generated key-cert
```
openssl req -x509 -nodes -days 365 -newkey rsa:2048 -keyout tls.key -out tls.crt -subj "/CN=lendea.com/O=lendea"

cat tls.crt | base64 -w 0
cat tls.key | base64 -w 0
```
### create secret
```
apiVersion: v1
kind: Secret
metadata:
  name: lendea-tls
data:
  tls.crt: LS0tLS1CRUdJTiBDRVJUSUZJQ0FURS0tLS0tCk1JSURMVENDQWhXZ0F3SUJBZ0lVTDdTa2h0NTVpbFhMV25FZWpYekdBQS9JVGw0d0RRWUpLb1pJaHZjTkFRRUwKQlFBd0pqRVRNQkVHQTFVRUF3d0tiR1Z1WkdWaExtTnZiVEVQTUEwR0ExVUVDZ3dHYkdWdVpHVmhNQjRYRFRJeApNVEV5T0RFMk5UUXpNMW9YRFRJeU1URXlPREUyTlRRek0xb3dKakVUTUJFR0ExVUVBd3dLYkdWdVpHVmhMbU52CmJURVBNQTBHQTFVRUNnd0diR1Z1WkdWaE1JSUJJakFOQmdrcWhraUc5dzBCQVFFRkFBT0NBUThBTUlJQkNnS0MKQVFFQTFiMjR4NGlSclllRzlxazU4RFlqMWk4cFc2K1F5akFJS25WZ0RzZExCbjExUlV4MjA4YTRLWWZQM0NINQpsYm5NaFRJZVFpNWFCV3JIM0ZPRkIxcUlBSUFPYVhkNFE4Sjd2ZkVzemJndjdCdjk2dGEzekNKTXI4ZEwzRGpJCllQbE05cFFXdGVTa2JvTkw5dG9NckNsNDZDQ2N1TXhONzEvUkt5RTg3V2M4eUkxL2xSNFVPbTNWS1RGQXM4eS8KOWRCbStsYmRmU2ZDUjhUdkNoVHNDTzZqSmRFMmJSUzJNTSt4TFlGUlJZNURHbkt0cm4vZjZyc1lpbDZhWStDWQpacmUza2ZRY2NMTzVBZFV5bEduWXdDek1FTVZ6dmdxd2p2M04zNlNoZG5HQzQrK0ppM0FzZVI0dXZ6ZDJlZmIwCkJwZytmNjZ5U2FXbzhiUitsYjBERnRPbTVRSURBUUFCbzFNd1VUQWRCZ05WSFE0RUZnUVUvb2FSWXZJMVcyVm0Kb3UvK0kzM3l4bFlpVnN3d0h3WURWUjBqQkJnd0ZvQVUvb2FSWXZJMVcyVm1vdS8rSTMzeXhsWWlWc3d3RHdZRApWUjBUQVFIL0JBVXdBd0VCL3pBTkJna3Foa2lHOXcwQkFRc0ZBQU9DQVFFQXZpY2NaTjlmMkZnRHpnenRvYW1SCjQwaXdWSk5xeERDcDJ2SGhsUHY0U1IwUnprbVhzUjNMTUtQZjQ2T01kb0Zva3owWXNFa0c2Si9BZGpaNkFBYXIKa3Blbnd6RWxRemZ4R0tjdlFKWUtBSk1wUndVbTJNaXRZdm1wNnRwTDQ0ZzZlMnFCaDRwTVhXMFNPZ3dhbTZMdQpRbEd3ZDd6R0V0MXZaVVViUSs4blJpZlRvS2xKbS9Ld2czU2NLK0RodTB0dTdsaGRJRjBsRWFMTDFWMUkvTUdGCnJEOWVlUUdBVGhKcURLcUFYWmZhU1AyTmx5QWhyN21zOGp3MkF1M3VqdXpnU3ZZVnh2cEpBYWpFcmd0U0o4UGsKNlVWQjg0bFRISWZHaEdtM2pNVWdWSVRWaVNCYTlmK1EwYi9LYTZ5TjdIeGpnaCtIbDM2MGxtaU9rWlhFOEh6awo1Zz09Ci0tLS0tRU5EIENFUlRJRklDQVRFLS0tLS0K
  tls.key: LS0tLS1CRUdJTiBQUklWQVRFIEtFWS0tLS0tCk1JSUV2Z0lCQURBTkJna3Foa2lHOXcwQkFRRUZBQVNDQktnd2dnU2tBZ0VBQW9JQkFRRFZ2YmpIaUpHdGg0YjIKcVRud05pUFdMeWxicjVES01BZ3FkV0FPeDBzR2ZYVkZUSGJUeHJncGg4L2NJZm1WdWN5Rk1oNUNMbG9GYXNmYwpVNFVIV29nQWdBNXBkM2hEd251OThTek51Qy9zRy8zcTFyZk1Ja3l2eDB2Y09NaGcrVXoybEJhMTVLUnVnMHYyCjJneXNLWGpvSUp5NHpFM3ZYOUVySVR6dFp6eklqWCtWSGhRNmJkVXBNVUN6ekwvMTBHYjZWdDE5SjhKSHhPOEsKRk93STdxTWwwVFp0RkxZd3o3RXRnVkZGamtNYWNxMnVmOS9xdXhpS1hwcGo0SmhtdDdlUjlCeHdzN2tCMVRLVQphZGpBTE13UXhYTytDckNPL2MzZnBLRjJjWUxqNzRtTGNDeDVIaTYvTjNaNTl2UUdtRDUvcnJKSnBhanh0SDZWCnZRTVcwNmJsQWdNQkFBRUNnZ0VCQUtLOGdyV1pLNkY5c0txWkNmMzBtckIyMC94MDNiNnpkMlFzWGVpaW9HTGUKbnEwV25OcDlVTForS3lxbHk0dk9IUVBFdHZrWXBYMitZVkZGWGVITmNnTS9mTG1jTnJzUWxucDE1L0R4cmJzTgpUUFRDYXNwSHl5K0NoQ1cyTGdwM2hidXY0T0s0cE9Gbm9pemV0QXRZd0Mrc3RPYVcxemZNTWt1dVVOOUlYU1VzCkFlMVc0VWJXZXM3cWVZMkQxb2NTejhuUTgrMWJGYUY3MVpXc1VObmg1MXlzNGJ4QlJTSjlJZDI4K2QxcVkzaFAKeFNoNkl3NEpqYUJlR0JKa1kwTk5NYnp5SUVaUWI4djN2RndaWkFMMlpISkU2VEk5b3IyYlk4LzNpMGs2M3F6agpsUmVURUxPWHFFcERtbjZTS0I0TXFJcVNPeDUrdXU2czgrTy9DUDdZandFQ2dZRUErVVl4S3lBN0REdnlwT0NtCnFzRzY4Q2ptalhPcVdDV1prdEVBYnpSR0JEMWNycmVpR3RVY2l2cktYdWp2VW9sK2kvZlJlL2QxaGVGQ2dKbFIKSnAwcUl4Wlpla1BscXArc0J5c1pTU2M1MU42ZHhVb3RwWU40d3Jlc1BmVThidnJuMkFjQXA1aExLMUJ0SWFDdwo3dmpMUVpueFM3aWlDMTdsRkg2VkY0cjRKbUVDZ1lFQTI0SVhzZ3NxMkQvWlI1S0VyWnE2TXZCWFFidFR3cWx4CkprM21aSkFFK1JhZ3pjNCtRanVrcmZJZUpKanByUUV4RGJhNTB0R2FQM0hnYVNCVVFEMG1ma3hJQkRkSnRjbloKbFlmaUh6ZkpSMG9UbCtJRlFzNkp6c0RaNkVSV3RBM0xMSzhCNW16dmVsT2NGTjcwYVRoV3JTSUUxQjVqMkhHSQoyM3I5ZE9FV1J3VUNnWUJaQzVUMjFkMmlBaXdzYjcrNTBkaW9mOFBVRmRSdEJvbDBvOHBtN3lKdjAwZXZkaE9uClNDZVpFZnVHcWVrTDcrZlBzaWdZQTQ3czAwb0JURU5yNnNxcG5BczhuTktHLytEZzhxbG1zMmQ2UGtmWHVTYlQKTUVMTU0vYUliM2sySDlVQUc0aEZWaWJNQXovb3VsRmFIRy9uTUVtOUJlaUU3VkloM3hIOVJmeGRJUUtCZ0IyMwpOczM3aFFsUlczQzgvUWtqY1NHRU44dkdPRWlaOTU5ZjNGaXd4bnVSL0tMZjBMM1dwU3lISWwyQjllQmQwTzR5ClZtV2J5bTNjVkt6bW00RTJ4Z2RDL0Z6VnZ6ekUzcGZIbFd6MGVHTVdQQ0RMa0RyREN4VGFOcVdpMnJuMVJCUUEKZlJsY2xlN1Jjc2ZBaHdYWGdxUmRmcG5ZbzF1aHd3MHpVU3lKYkNLaEFvR0JBSWRzSE10cXZ5R2FoZ2hTMlhkaQpaVSs5aEMwMURwNE1UZHV5KzBiQWhWZDFoclg0Ry8yOWtXU0RGd3dZMHovL3Z6WG52Q3krUTZVMGJaY3NPVXJICjZBbWl6bFV0UWZ0cU04aGhkL0RyWmFnbm1wSk53a2prVzZjVkJjSktVdjg5Q0pveHZkRTU1SkdMcFhBc050dFMKcTY3b3JZbHZPK0Q5eVpJQ05rd3ZremFpCi0tLS0tRU5EIFBSSVZBVEUgS0VZLS0tLS0K
type: kubernetes.io/tls

```
### create a ingress
```
kubectl create -f ingress.yaml
```
### test the result
```
curl -H "Host: lendea.com" https://10.109.204.181 -v -k
```
### understand why ingress is not enough?
- tls: cypher, dhkey, TLSVersion
- header based L7 rule
- rewriting?
    - header rewriting
    - URI rewriting

### how rewrite is supported in nginx ingress
```
Name	Description	Values
nginx.ingress.kubernetes.io/rewrite-target	Target URI where the traffic must be redirected	string
nginx.ingress.kubernetes.io/ssl-redirect	Indicates if the location section is accessible SSL only (defaults to True when Ingress contains a Certificate)	bool
nginx.ingress.kubernetes.io/force-ssl-redirect	Forces the redirection to HTTPS even if the Ingress is not TLS Enabled	bool
nginx.ingress.kubernetes.io/app-root	Defines the Application Root that the Controller must redirect if it's in '/' context	string
nginx.ingress.kubernetes.io/use-regex	Indicates if the paths defined on an Ingress use regular expressions	bool
```
